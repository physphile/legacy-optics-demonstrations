<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body style="margin: 0px; padding: 0px;">
    <canvas id="myCanvas" width="500" height="350" style="border:1px solid #939393; z-index:1" onmousedown="mouseDown(event)" onmouseup="mouseUp(event)" onmousemove="mouseDrag(event)">
        Your browser does not support the canvas element.
    </canvas>
    <label id="velocity" style="position: absolute; top: 270px; left: 400px;">speed=21</label>
    <button id="speedInc" onclick="ButtonPress()" ; style="position: absolute; top: 300px; left: 430px;">+</button>
    <button id="speedDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 300px; left: 400px;">-</button>
    <button id="XInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 90px; left: 310px;">+</button>
    <button id="XDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 120px; left: 310px;">-</button>
    <button id="YInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 20px; left: 105px;">+</button>
    <button id="YDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 20px; left: 75px;">-</button>
    <button id="ZInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 150px; left: 20px;">+</button>
    <button id="ZDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 180px; left: 50px;">-</button>
    <button id="stopButton" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 220px; left: 410px;">Pause</button>
    <button id="stepButton" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 260px; left: 380px; visibility: hidden">Step</button>
    <button id="startButton" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 260px; left: 420px; visibility: hidden">Start</button>
    <button id="recInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 220px; left: 350px; ">+</button>
    <button id="recDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 220px; left: 320px; ">-</button>
    <button id="phasaInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 260px; left: 350px;">+</button>
    <button id="phasaDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 260px; left: 320px; ">-</button>
    <button id="amplInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 300px; left: 350px;">+</button>
    <button id="amplDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 300px; left: 320px; ">-</button>
    <label id="rec" style="position: absolute; top: 200px; left: 335px;">rec=90.0</label>
    <label id="phase" style="position: absolute; top: 240px; left: 335px;">Phase=90.0</label>
    <label id="amp" style="position: absolute; top: 280px; left: 335px;">Amp2=1xAmp1</label>
    <button id="recCristallInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 220px; left: 480px; ">+</button>
    <button id="recCristallDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 200px; left: 450px; ">-</button>
    <button id="thickCristallInc" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 260px; left: 480px; ">+</button>
    <button id="thickCristallDec" onclick="ButtonPress()" ; style="position: absolute; z-index:2; top: 260px; left: 450px; ">-</button>
    <label id="cristallRecLabel" style="position: absolute; top: 200px; left: 450px">Cristall Rec=30 </label>
    <label id="CristallThickLabel" style="position: absolute; top: 240px; left: 450px;">Cristall Thick=lambda/8 </label>




    <script>
        var cristallRecLabel = document.getElementById("cristallRecLabel");
        var CristallThickLabel = document.getElementById("CristallThickLabel");
        var recInc = document.getElementById("recInc");
        var recDec = document.getElementById("recDec");
        var recCristallInc = document.getElementById("recCristallInc");
        var recCristallDec = document.getElementById("recCristallDec");
        var thickCristallInc = document.getElementById("thickCristallInc");
        var thickCristallDec = document.getElementById("thickCristallDec");
        var phasaInc = document.getElementById("phasaInc");
        var phasaDec = document.getElementById("phasaDec");
        var amplInc = document.getElementById("amplInc");
        var amplDec = document.getElementById("amplDec");;
        var speedL = document.getElementById("velocity");
        var rec = document.getElementById("rec");
        var phase = document.getElementById("phase");
        var amp = document.getElementById("amp");
        var stopButton = document.getElementById("stopButton");
        var speedInc = document.getElementById("speedInc");
        var speedDec = document.getElementById("speedDec");
        var XInc = document.getElementById("XInc");
        var XDec = document.getElementById("XDec");
        var YInc = document.getElementById("YInc");
        var YDec = document.getElementById("YDec");
        var ZInc = document.getElementById("ZInc");
        var ZDec = document.getElementById("ZDec");
        var stepButton = document.getElementById("stepButton");
        var startButton = document.getElementById("startButton");
        var recX, recY, recZ, cosX, sinX, cosY, sinY, cosZ, sinZ, phasa, recBet, ampl;
        var time, xOffset, yOffset, linePosition, regX, regY, speedOne, speedStop, redDotCounter;
        var s;
        var listCristallThick = [
           "0", "1/16", "1/8", "3/16", "1/4", "5/16", "3/8", "7/16", "1/2", "9/16", "5/8", "11/16", "3/4", "13/16", "7/8", "15/16", "1"
        ];
        var phasa2 = 45;
        var speedOne = 6;
        var recCristall = 30;
        var resultArrayX = []; /*= new int[60];*/
        var resultArrayY = []; /*= new int[60];*/
        var resultAfterX = [];
        var resultAfterY = [];
        var arrayNumber;
        var starting, lineMoving;
        var scaleX = (window.innerWidth) / 600;
        var scaleY = (window.innerHeight) / 350;
        var updateCount = 120;
        // buffer canvas
        var buffCanvas = document.createElement('canvas');
        buffCanvas.width = 700 * scaleX;
        buffCanvas.height = 350 * scaleX;
        var buffCtx = buffCanvas.getContext('2d');
        // *************


        window.onresize = function () {
            scaleX = (window.innerWidth) / 700;
            scaleY = (window.innerHeight) / 350;
            if (scaleY < scaleX) scaleX = scaleY;
            canvas.width = 700 * scaleX;
            canvas.height = 350 * scaleX;
            buffCanvas.width = 700 * scaleX;
            buffCanvas.height = 350 * scaleX;
            stopButton.style.top = (220 * scaleX).toString() + 'px';
            stopButton.style.left = (410 * scaleX).toString() + 'px';
            speedL.style.top = (270 * scaleX).toString() + 'px';
            speedL.style.left = (400 * scaleX).toString() + 'px';
            speedInc.style.top = (300 * scaleX).toString() + 'px';
            speedInc.style.left = (430 * scaleX).toString() + 'px';
            speedDec.style.top = (300 * scaleX).toString() + 'px';
            speedDec.style.left = (400 * scaleX).toString() + 'px';
            XInc.style.top = (90 * scaleX).toString() + 'px';
            XInc.style.left = (310 * scaleX).toString() + 'px';
            XDec.style.top = (120 * scaleX).toString() + 'px';
            XDec.style.left = (310 * scaleX).toString() + 'px';
            YInc.style.top = (20 * scaleX).toString() + 'px';
            YInc.style.left = (105 * scaleX).toString() + 'px';
            YDec.style.top = (20 * scaleX).toString() + 'px';
            YDec.style.left = (75 * scaleX).toString() + 'px';
            ZInc.style.top = (150 * scaleX).toString() + 'px';
            ZInc.style.left = (20 * scaleX).toString() + 'px';
            ZDec.style.top = (180 * scaleX).toString() + 'px';
            ZDec.style.left = (50 * scaleX).toString() + 'px';
            stepButton.style.top = (260 * scaleX).toString() + 'px';
            stepButton.style.left = (380 * scaleX).toString() + 'px';
            startButton.style.top = (260 * scaleX).toString() + 'px';
            startButton.style.left = (420 * scaleX).toString() + 'px';
            recInc.style.top = (220 * scaleX).toString() + 'px';
            recInc.style.left = (350 * scaleX).toString() + 'px';
            recDec.style.top = (220 * scaleX).toString() + 'px';
            recDec.style.left = (320 * scaleX).toString() + 'px';
            phasaInc.style.top = (260 * scaleX).toString() + 'px';
            phasaInc.style.left = (350 * scaleX).toString() + 'px';
            phasaDec.style.top = (260 * scaleX).toString() + 'px';
            phasaDec.style.left = (320 * scaleX).toString() + 'px';
            amplInc.style.top = (300 * scaleX).toString() + 'px';
            amplInc.style.left = (350 * scaleX).toString() + 'px';
            amplDec.style.top = (300 * scaleX).toString() + 'px';
            amplDec.style.left = (320 * scaleX).toString() + 'px';
            rec.style.left = (335 * scaleX).toString() + 'px';
            rec.style.top = (200 * scaleX).toString() + 'px';
            phase.style.left = (335 * scaleX).toString() + 'px';
            phase.style.top = (240 * scaleX).toString() + 'px';
            amp.style.left = (335 * scaleX).toString() + 'px';
            amp.style.top = (280 * scaleX).toString() + 'px';

            recCristallInc.style.top = (220 * scaleX).toString() + 'px';
            recCristallInc.style.left = (480 * scaleX).toString() + 'px';
            recCristallDec.style.top = (220 * scaleX).toString() + 'px';
            recCristallDec.style.left = (450 * scaleX).toString() + 'px';
            thickCristallInc.style.top = (260 * scaleX).toString() + 'px';
            thickCristallInc.style.left = (480 * scaleX).toString() + 'px';
            thickCristallDec.style.top = (260 * scaleX).toString() + 'px';
            thickCristallDec.style.left = (450 * scaleX).toString() + 'px';
            CristallThickLabel.style.top = (240 * scaleX).toString() + 'px';
            CristallThickLabel.style.left = (450 * scaleX).toString() + 'px';
            cristallRecLabel.style.top = (200 * scaleX).toString() + 'px';
            cristallRecLabel.style.left = (450 * scaleX).toString() + 'px';

            drawAxes(buffCtx);
            drawStaticGraph(buffCtx);
            update();
        }

        document.documentElement.style.overflow = 'hidden'; // firefox, chrome
        document.body.scroll = "no"; // ie only
        xOffset = 100;
        yOffset = 120;
        speed = 10;
        intSpeed = 10;
        recX = 3e-1;
        cosX = Math.cos(recX);
        sinX = Math.sin(recX);
        recY = -3e-1;
        cosY = Math.cos(recY);
        sinY = Math.sin(recY);
        recZ = 0;
        cosZ = 1;
        sinZ = 0;
        time = 0;
        redDotCounter = 0;
        arrayNumber = 0;
        xOffset = 100;
        yOffset = 120;
        phasa = 90;
        ampl = 1;
        recBet = 90;
        linePosition = 80;
        lineMoving = false;
        speedOne = 6;
        var canvas = document.getElementById("myCanvas");
        canvas.width = 700 * scaleX;
        canvas.height = 350 * scaleX;
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "#9F9f9f";
        ctx.fillRect(0, 0, 500 * scaleX, 350 * scaleX);
        ctx.fillStyle = "#000000";
        ctx.font = "20px Arial";
        drawGraph(ctx);
        drawAxes(ctx);
        drawAxes(buffCtx);
        drawStaticGraph(buffCtx);
        window.onresize();

        timerInt = setInterval(update, intSpeed);

        function ButtonPress() {
            switch (ButtonPress.caller.arguments[0].target.id) {
            case 'stopButton':
                clearInterval(timerInt);
                startButton.style.visibility = 'visible';
                stepButton.style.visibility = 'visible';
                stopButton.style.visibility = 'hidden';
                speedInc.style.visibility = 'hidden';
                speedDec.style.visibility = 'hidden';
                speedLeft = 0;

                break;
            case 'startButton':
                timerInt = setInterval(update, intSpeed);
                stopButton.style.visibility = 'visible';
                startButton.style.visibility = 'hidden';
                stepButton.style.visibility = 'hidden';
                speedInc.style.visibility = 'visible';
                speedDec.style.visibility = 'visible';
                speedLeft = 10;
                break;
            case 'stepButton':
                speedLeft = 10;
                update();
                speedLeft = 0;
                break;
            case 'speedInc':
                if (intSpeed > 1) intSpeed--;
                speedL.innerHTML = "speed=" + (31 - intSpeed).toString();
                clearInterval(timerInt);
                timerInt = setInterval(update, intSpeed);
                break;
            case 'speedDec':
                if (intSpeed < 30) intSpeed++;
                speedL.innerHTML = "speed=" + (31 - intSpeed).toString();
                clearInterval(timerInt);
                timerInt = setInterval(update, intSpeed);
                break;
            case 'XInc':
                if (recX > -1) {
                    recX = recX - 1e-1;
                    cosX = Math.cos(recX);
                    sinX = Math.sin(recX);
                    update();

                }
                break;
            case 'recInc':

                if (recBet <= 180) {
                    recBet += 5;
                    arrayNumber = 0;


                }
                rec.innerHTML = "rec=" + (recBet).toString();
                updateCount = 120;


                break;
            case 'recDec':

                if (recBet >= -180) {
                    recBet -= 5;
                    arrayNumber = 0;

                }
                rec.innerHTML = "rec=" + (recBet).toString();
                updateCount = 120;

                break;
            case 'recCristallInc':

                if (recCristall < 360) {
                    recCristall += 5;
                    arrayNumber = 0;


                }
                cristallRecLabel.innerHTML = "Cristall Rec=" + (recCristall).toString();
                updateCount = 120;


                break;
            case 'recCristallDec':

                if (recCristall > -360) {
                    recCristall -= 5;
                    arrayNumber = 0;

                }
                cristallRecLabel.innerHTML = "Cristall Rec=" + (recCristall).toString();
                updateCount = 120;

                break;
            case 'thickCristallInc':

                if (phasa2 < 360) {
                    phasa2 += 15;
                    arrayNumber = 0;


                }
                CristallThickLabel.innerHTML = "Cristall Thick=lambda/" + (Math.round(36000/phasa2)/100).toString();
                updateCount = 120;


                break;
            case 'thickCristallDec':

                if (phasa2 > -360) {
                    phasa2 -= 15;
                    arrayNumber = 0;

                }
                CristallThickLabel.innerHTML = "Cristall Thick=lambda/" + (Math.round(36000/phasa2)/100).toString();
                updateCount = 120;

                break;
            case 'phasaInc':

                if (phasa <= 360) {
                    phasa += 5;
                    arrayNumber = 0;
                }
                phase.innerHTML = "Phase=" + (phasa).toString();
                updateCount = 120;


                break;
            case 'phasaDec':

                if (phasa >= -360) {
                    phasa -= 5;
                    arrayNumber = 0;

                }
                phase.innerHTML = "phase=" + (phasa).toString();
                updateCount = 120;


                break;
            case 'amplInc':

                if (ampl < 2) {
                    ampl += 0.05;
                    arrayNumber = 0;

                }
                amp.innerHTML = "Amp2=" + (ampl).toLocaleString(undefined) + "xAmp1";
                updateCount = 120;
                break;
            case 'amplDec':

                if (ampl > 0) {
                    ampl -= 0.05;
                    arrayNumber = 0;


                }
                amp.innerHTML = "Amp2=" + (ampl).toLocaleString(undefined) + "xAmp1";
                updateCount = 120;


                break;
            case 'XDec':
                if (recX < 1) {
                    recX = recX + 1e-1;
                    cosX = Math.cos(recX);
                    sinX = Math.sin(recX);
                    update();
                }
                break;
            case 'YInc':
                if (recY < 2) {
                    recY = recY + 1e-1;
                    cosY = Math.cos(recY);
                    sinY = Math.sin(recY);
                    update();
                }

                break;
            case 'YDec':
                if (recY > -2) {
                    recY = recY - 1e-1;
                    cosY = Math.cos(recY);
                    sinY = Math.sin(recY);
                    update();
                }

                break;
            case 'ZInc':
                if (recZ < 1) {
                    recZ = recZ + 1e-1;
                    cosZ = Math.cos(recZ);
                    sinZ = Math.sin(recZ);
                    update();
                }

                break;
            case 'ZDec':
                if (recZ > -1) {
                    recZ = recZ - 1e-1;
                    cosZ = Math.cos(recZ);
                    sinZ = Math.sin(recZ);
                    update();
                }

                break;
            }
            // 
        }

        function update() {
            if (updateCount > 0) {
                updateCount--;
                drawAxes(buffCtx);
                drawStaticGraph(buffCtx);
            }
            ctx.drawImage(buffCanvas, 0, 0);
            drawGraph(ctx);

        }

        function drawLine(drawctx, x, y, z, t) {
            drawctx.beginPath();
            drawctx.moveTo(x * scaleX, y * scaleX);
            drawctx.lineTo(z * scaleX, t * scaleX);
            drawctx.stroke();
            drawctx.closePath();
        }

        function drawOval(drawctx, x, y, h, w) {
            drawctx.beginPath();
            drawctx.arc((x + w / 2) * scaleX, (y + h / 2) * scaleX, (w + h) / 4 * scaleX, 0, 2 * Math.PI);
            drawctx.stroke();
            drawctx.closePath();
        }

        function fillOval(drawctx, x, y, h, w) {
            drawctx.beginPath();
            drawctx.arc((x + w / 2) * scaleX, (y + h / 2) * scaleX, (w + h) / 4 * scaleX, 0, 2 * Math.PI);
            drawctx.fill();
            drawctx.closePath();

        }

        function setColor(drawctx, Color) {
            drawctx.strokeStyle = Color;
        }

        function drawString(drawctx, str, x, y) {
            drawctx.font = "20px Arial";
            drawctx.fillText(str, x * scaleX, y * scaleX);
        }


        function drawMyLine(drawctx, startX, startY, startZ, endX, endY, endZ) {
            var realStartX, realStartY, realEndX, realEndY, realStartZ, realEndZ;
            realStartX = startX;
            realStartY = startY * cosX - startZ * sinX;
            realStartZ = startY * sinX + startZ * cosX;
            realEndX = endX;
            realEndY = endY * cosX - endZ * sinX;
            realEndZ = endY * sinX + endZ * cosX;
            realStartX = realStartX * cosY + realStartZ * sinY;
            realStartZ = -realStartZ * sinY + realStartZ * cosY;
            realEndX = realEndX * cosY + realEndZ * sinY;
            realEndZ = -realEndZ * sinY + realEndZ * cosY;
            realStartX = realStartX * cosZ - realStartY * sinZ;
            realStartY = realStartX * sinZ + realStartY * cosZ;
            realEndX = realEndX * cosZ - realEndY * sinZ;
            realEndY = realEndX * sinZ + realEndY * cosZ;
            drawLine(drawctx, realStartX + xOffset, -realStartY + yOffset, realEndX + xOffset, -realEndY + yOffset);
            regX = realEndX + xOffset;
            regY = -realEndY + yOffset;
        }

        function drawGraph(drawctx) {
            var firstX, secondX, firstY, secondY;
            time = time + speedOne;
            redDotCounter += speedOne;

            if (time > 359) {
                time = 0;
                starting = false;
            }
            var oldY, newY, oldBack, newBack, ddZ, ddY, circSecondX, circSecondY, circResultX, circResultY, alpha, betta, crisEY, crisEBack, sinCr, cosCr, sinCrBet, cosCrBet, newEnPad, minEnPad, maxEnPad, newEnProsh, minEnProsh, maxEnProsh;
            minEnProsh = 0;
            maxEnProsh = 0;
            minEnPad = 0;
            maxEnPad = 0;
            ddZ = Math.sin(recBet / 180 * Math.PI);
            ddY = Math.cos(recBet / 180 * Math.PI);
            sinCr = Math.sin(recCristall / 180 * Math.PI);
            cosCr = Math.cos(recCristall / 180 * Math.PI);
            sinCrBet = Math.sin((recCristall - recBet) / 180 * Math.PI);
            cosCrBet = Math.cos((recCristall - recBet) / 180 * Math.PI);
            oldY = 0;
            oldBack = 0;
            circResultX = 0;
            circResultY = 0;
            for (i = 1; i < 80; i = i + 1) {
                newY = Math.cos((time - i * 6) / 180 * Math.PI);
                newBack = Math.cos((time + phasa - i * 6) / 180 * Math.PI) * ampl;
                circResultX = newBack * 70.0 * ddZ;
                circSecondY = newBack * 70.0 * ddY;
                circResultY = (circSecondY + newY * 70);
                circSecondX = oldBack * 70 * ddZ;
                circSecondY = oldBack * 70 * ddY + oldY * 70;
                newEnPad = (newY + newBack * ddY) * (newY + newBack * ddY) * 20 + (newBack * ddZ) * (newBack * ddZ) * 20;

                if (i == 1) {
                    oldY = newY;
                    oldBack = newBack;
                    minEnPad = newEnPad;
                    maxEnPad = newEnPad;
                } else {
                    if (newEnPad > maxEnPad) maxEnPad = newEnPad;
                    else if (newEnPad < minEnPad) minEnPad = newEnPad;
                }

                setColor(drawctx, "#FF0000");
                drawMyLine(drawctx, i - 1, circSecondY, circSecondX, i, circResultY, circResultX);
                if (i % 3 == 0) {
                    drawMyLine(drawctx, i, 0, 0, i, circResultY, circResultX);
                }

                setColor(drawctx, "#000000");
                drawLine(drawctx, i + 99, 339 - ((oldY + oldBack * ddY) * (oldY + oldBack * ddY) * 20 + (oldBack * ddZ) * (oldBack * ddZ) * 20), i + 100, 339 - (newEnPad));
                oldBack = newBack;
                oldY = newY;

            }
            setColor(drawctx, "#FFFFFF");
            maxEnPad = (maxEnPad + minEnPad) / 2;
            drawLine(drawctx, 100, 339 - parseInt(maxEnPad), 180, 339 - parseInt(maxEnPad));
            //	alpha=Math.atan(circResultX/circResultY);
            //	if (circResultY < 0) alpha=alpha+Math.PI;
            //	betta=recCristall-alpha/Math.PI*180;

            circSecondY = 0;
            circSecondX = 0;
            for (i = 90; i < 200; i++) {
                newY = Math.cos((time - i * 6) / 180 * Math.PI) * cosCr;
                newBack = Math.cos((time + phasa - i * 6) / 180 * Math.PI) * cosCrBet * ampl;
                crisEY = Math.cos((time + phasa2 - i * 6) / 180 * Math.PI) * sinCr;
                crisEBack = Math.cos((time + phasa + phasa2 - i * 6) / 180 * Math.PI) * sinCrBet * ampl;

                circResultX = (newBack + newY) * 70.0 * cosCr + (crisEY + crisEBack) * 70 * sinCr;
                //	    circSecondY=newBack*70.0*ddY;
                circResultY = (newBack + newY) * 70.0 * sinCr - (crisEY + crisEBack) * 70 * cosCr;
                newEnProsh = circResultX * circResultX / 4900 * 20 + circResultY * circResultY / 4900 * 20;
                if (i == 90) {
                    circSecondX = circResultX;
                    circSecondY = circResultY;
                    minEnProsh = newEnProsh;
                    maxEnProsh = newEnProsh;
                } else {
                    setColor(drawctx, "#000000");
                    drawLine(drawctx, i + 99, 339 - (circSecondX * circSecondX / 4900 * 20 + circSecondY * circSecondY / 4900 * 20), i + 100, 339 - (newEnProsh));

                    if (newEnProsh > maxEnProsh) maxEnProsh = newEnProsh;
                    else if (newEnProsh < minEnProsh) minEnProsh = newEnProsh;
                }
                //	    circSecondX=oldBack*70*ddZ;
                //	    circSecondY=oldBack*70*ddY+oldY*70;
                setColor(drawctx, "#fff800");
                drawMyLine(drawctx, i - 1, circSecondX, circSecondY, i, circResultX, circResultY);
                if (i % 3 == 0) {
                    drawMyLine(drawctx, i, 0, 0, i, circResultX, circResultY);
                }

                circSecondX = circResultX;
                circSecondY = circResultY;
            }

            maxEnProsh = (maxEnProsh + minEnProsh) / 2;
            setColor(drawctx, "#FFFFFF");
            drawLine(drawctx, 190, 339 - parseInt(maxEnProsh), 300, 339 - parseInt(maxEnProsh));
            //	tmmmp="rec "+(int)(recCristall-recBet);
            //	g.drawString(tmmmp,200,200);

            //draw second circle...

            newY = Math.cos((time - 90 * 6) / 180 * Math.PI) * cosCr;
            newBack = Math.cos((time + phasa - 90 * 6) / 180 * Math.PI) * cosCrBet * ampl;
            crisEY = Math.cos((time + phasa2 - 90 * 6) / 180 * Math.PI) * sinCr;
            crisEBack = Math.cos((time + phasa + phasa2 - 90 * 6) / 180 * Math.PI) * sinCrBet * ampl;

            circSecondX = newY + newBack;
            circSecondY = crisEY + crisEBack;
            circResultX = circSecondX * cosCr;
            circResultY = circSecondX * sinCr;
            setColor(drawctx, "#00FF00");
            drawLine(drawctx, 569, 120, 569 - (70 * circResultY), 120 - (circResultX * 70));
            drawLine(drawctx, 570, 120, 570 - (70 * circResultY), 120 - (circResultX * 70));
            drawLine(drawctx, 571, 120, 571 - (70 * circResultY), 120 - (circResultX * 70));
            circResultX = circSecondY * 70 * sinCr;
            circResultY = circSecondY * 70.0 * cosCr;
            setColor(drawctx, "#0000FF");
            drawLine(drawctx, 569, 119, 569 + circResultY, 120 - circResultX);
            drawLine(drawctx, 570, 120, 570 + circResultY, 120 - circResultX);
            drawLine(drawctx, 568, 118, 568 + circResultY, 120 - circResultX);

            //        circResultX=newBack*70.0*Math.sin(recBet/180*Math.PI);
            //        circSecondY=newBack*70.0*Math.cos(recBet/180*Math.PI);
            circResultX = (newBack + newY) * 70.0 * cosCr + (crisEY + crisEBack) * 70 * sinCr;

            circResultY = (newBack + newY) * 70.0 * sinCr - (crisEY + crisEBack) * 70 * cosCr;
            //        circResultY=(circSecondY+newY*70);
            if (redDotCounter >= 10) {
                if (arrayNumber < 60) {
                    resultAfterY[arrayNumber] = circResultX;
                    resultAfterX[arrayNumber] = circResultY;
                    //            arrayNumber++;
                } else {
                    for (tmp = 0; tmp < 59; tmp++) {
                        resultAfterX[tmp] = resultAfterX[tmp + 1];
                        resultAfterY[tmp] = resultAfterY[tmp + 1];
                    }
                    resultAfterY[59] = circResultX;
                    resultAfterX[59] = circResultY;
                }
            }
            setColor(drawctx, "#fff800");
            // for (tmp = 0; tmp < arrayNumber - 1; tmp++) fillOval(drawctx, 568 - resultAfterX[tmp], 118 - resultAfterY[tmp], 5, 5);
            drawLine(drawctx, 569, 119, 569 - circResultY, 119 - circResultX);
            drawLine(drawctx, 570, 120, 570 - circResultY, 120 - circResultX);
            drawLine(drawctx, 571, 121, 571 - circResultY, 121 - circResultX);


            //draw First circle...

            newY = Math.cos((time - 80 * 6) / 180 * Math.PI);
            newBack = Math.cos((time + phasa - 80 * 6) / 180 * Math.PI) * ampl;
            circSecondX = newY * cosCr + newBack * cosCrBet;
            circSecondY = newY * sinCr + newBack * sinCrBet;
            circResultX = circSecondX * cosCr;
            circResultY = circSecondX * sinCr;
            setColor(drawctx, "#00ff00");
            drawLine(drawctx, 419, 120, 419 - (70 * circResultY), 120 - (circResultX * 70));
            drawLine(drawctx, 420, 120, 420 - (70 * circResultY), 120 - (circResultX * 70));
            drawLine(drawctx, 421, 120, 421 - (70 * circResultY), 120 - (circResultX * 70));
            circResultX = circSecondY * 70 * sinCr;
            circResultY = circSecondY * 70.0 * cosCr;
            setColor(drawctx, "#0000ff");
            drawLine(drawctx, 419, 119, 419 + circResultY, 120 - circResultX);
            drawLine(drawctx, 420, 120, 420 + circResultY, 120 - circResultX);
            drawLine(drawctx, 418, 118, 418 + circResultY, 120 - circResultX);
            circResultX = newBack * 70.0 * Math.sin(recBet / 180 * Math.PI);
            circSecondY = newBack * 70.0 * Math.cos(recBet / 180 * Math.PI);
            circResultY = (circSecondY + newY * 70);
            if (redDotCounter >= 10) {
                redDotCounter = 0;
                if (arrayNumber < 60) {
                    resultArrayX[arrayNumber] = circResultX;
                    resultArrayY[arrayNumber] = circResultY;
                    arrayNumber++;
                } else {
                    for (tmp = 0; tmp < 59; tmp++) {
                        resultArrayX[tmp] = resultArrayX[tmp + 1];
                        resultArrayY[tmp] = resultArrayY[tmp + 1];
                    }
                    resultArrayX[59] = circResultX;
                    resultArrayY[59] = circResultY;
                }
            }
            setColor(drawctx, "#ff0000");
            //for (tmp = 0; tmp < arrayNumber - 1; tmp++) fillOval(drawctx, 418 - resultArrayX[tmp], 118 - resultArrayY[tmp], 5, 5);
            drawLine(drawctx, 419, 119, 419 - circResultX, 119 - circResultY);
            drawLine(drawctx, 420, 120, 420 - circResultX, 120 - circResultY);
            drawLine(drawctx, 421, 121, 421 - circResultX, 121 - circResultY);
        }

        function drawStaticGraph(drawctx) {
            var firstX, secondX, firstY, secondY;

            var oldY, newY, oldBack, newBack, ddZ, ddY, circSecondX, circSecondY, circResultX, circResultY, alpha, betta, crisEY, crisEBack, sinCr, cosCr, sinCrBet, cosCrBet, newEnPad, minEnPad, maxEnPad, newEnProsh, minEnProsh, maxEnProsh;
            minEnProsh = 0;
            maxEnProsh = 0;
            minEnPad = 0;
            maxEnPad = 0;
            ddZ = Math.sin(recBet / 180 * Math.PI);
            ddY = Math.cos(recBet / 180 * Math.PI);
            sinCr = Math.sin(recCristall / 180 * Math.PI);
            cosCr = Math.cos(recCristall / 180 * Math.PI);
            sinCrBet = Math.sin((recCristall - recBet) / 180 * Math.PI);
            cosCrBet = Math.cos((recCristall - recBet) / 180 * Math.PI);
            oldY = 0;
            oldBack = 0;
            circResultX = 0;
            circResultY = 0;
            for (i = 1; i < 80; i = i + 1) {
                newY = Math.cos((time - i * 6) / 180 * Math.PI);
                newBack = Math.cos((time + phasa - i * 6) / 180 * Math.PI) * ampl;
                circResultX = newBack * 70.0 * ddZ;
                circSecondY = newBack * 70.0 * ddY;
                circResultY = (circSecondY + newY * 70);
                circSecondX = oldBack * 70 * ddZ;
                circSecondY = oldBack * 70 * ddY + oldY * 70;
                newEnPad = (newY + newBack * ddY) * (newY + newBack * ddY) * 20 + (newBack * ddZ) * (newBack * ddZ) * 20;

                if (i == 1) {
                    oldY = newY;
                    oldBack = newBack;
                    minEnPad = newEnPad;
                    maxEnPad = newEnPad;
                } else {
                    if (newEnPad > maxEnPad) maxEnPad = newEnPad;
                    else if (newEnPad < minEnPad) minEnPad = newEnPad;
                }

                //setColor(drawctx, "#FF0000");
                //drawMyLine(drawctx, i - 1, circSecondY, circSecondX, i, circResultY, circResultX);
                if (i % 3 == 0) {
                    // drawMyLine(drawctx, i, 0, 0, i, circResultY, circResultX);
                }

                //setColor(drawctx, "#000000");
                //drawLine(drawctx, i + 99, 339 - ((oldY + oldBack * ddY) * (oldY + oldBack * ddY) * 20 + (oldBack * ddZ) * (oldBack * ddZ) * 20), i + 100, 339 - (newEnPad));
                oldBack = newBack;
                oldY = newY;

            }
            setColor(drawctx, "#FFFFFF");
            maxEnPad = (maxEnPad + minEnPad) / 2;
            drawLine(drawctx, 100, 339 - parseInt(maxEnPad), 180, 339 - parseInt(maxEnPad));


            circSecondY = 0;
            circSecondX = 0;
            for (i = 90; i < 200; i++) {
                newY = Math.cos((time - i * 6) / 180 * Math.PI) * cosCr;
                newBack = Math.cos((time + phasa - i * 6) / 180 * Math.PI) * cosCrBet * ampl;
                crisEY = Math.cos((time + phasa2 - i * 6) / 180 * Math.PI) * sinCr;
                crisEBack = Math.cos((time + phasa + phasa2 - i * 6) / 180 * Math.PI) * sinCrBet * ampl;

                circResultX = (newBack + newY) * 70.0 * cosCr + (crisEY + crisEBack) * 70 * sinCr;
                //	    circSecondY=newBack*70.0*ddY;
                circResultY = (newBack + newY) * 70.0 * sinCr - (crisEY + crisEBack) * 70 * cosCr;
                newEnProsh = circResultX * circResultX / 4900 * 20 + circResultY * circResultY / 4900 * 20;
                if (i == 90) {
                    circSecondX = circResultX;
                    circSecondY = circResultY;
                    minEnProsh = newEnProsh;
                    maxEnProsh = newEnProsh;
                } else {
                    //setColor(drawctx, "#000000");
                    //drawLine(drawctx, i + 99, 339 - (circSecondX * circSecondX / 4900 * 20 + circSecondY * circSecondY / 4900 * 20), i + 100, 339 - (newEnProsh));

                    if (newEnProsh > maxEnProsh) maxEnProsh = newEnProsh;
                    else if (newEnProsh < minEnProsh) minEnProsh = newEnProsh;
                }
                //	    circSecondX=oldBack*70*ddZ;
                //	    circSecondY=oldBack*70*ddY+oldY*70;
                //setColor(drawctx, "#fff800");
                //drawMyLine(drawctx, i - 1, circSecondX, circSecondY, i, circResultX, circResultY);
                if (i % 3 == 0) {
                    //drawMyLine(drawctx, i, 0, 0, i, circResultX, circResultY);
                }

                circSecondX = circResultX;
                circSecondY = circResultY;
            }

            maxEnProsh = (maxEnProsh + minEnProsh) / 2;
            setColor(drawctx, "#FFFFFF");
            drawLine(drawctx, 190, 339 - parseInt(maxEnProsh), 300, 339 - parseInt(maxEnProsh));
            //	tmmmp="rec "+(int)(recCristall-recBet);
            //	g.drawString(tmmmp,200,200);

            //draw second circle...
            newY = Math.cos((time - 90 * 6) / 180 * Math.PI) * cosCr;
            newBack = Math.cos((time + phasa - 90 * 6) / 180 * Math.PI) * cosCrBet * ampl;
            crisEY = Math.cos((time + phasa2 - 90 * 6) / 180 * Math.PI) * sinCr;
            crisEBack = Math.cos((time + phasa + phasa2 - 90 * 6) / 180 * Math.PI) * sinCrBet * ampl;

            circSecondX = newY + newBack;
            circSecondY = crisEY + crisEBack;
            circResultX = circSecondX * cosCr;
            circResultY = circSecondX * sinCr;
            //setColor(drawctx, "#00FF00");
            //drawLine(drawctx, 569, 120, 569 - (70 * circResultY), 120 - (circResultX * 70));
            //drawLine(drawctx, 570, 120, 570 - (70 * circResultY), 120 - (circResultX * 70));
            //drawLine(drawctx, 571, 120, 571 - (70 * circResultY), 120 - (circResultX * 70));
            circResultX = circSecondY * 70 * sinCr;
            circResultY = circSecondY * 70.0 * cosCr;
            //setColor(drawctx, "#0000FF");
            //drawLine(drawctx, 569, 119, 569 + circResultY, 120 - circResultX);
            //drawLine(drawctx, 570, 120, 570 + circResultY, 120 - circResultX);
            //drawLine(drawctx, 568, 118, 568 + circResultY, 120 - circResultX);

            //        circResultX=newBack*70.0*Math.sin(recBet/180*Math.PI);
            //        circSecondY=newBack*70.0*Math.cos(recBet/180*Math.PI);
            circResultX = (newBack + newY) * 70.0 * cosCr + (crisEY + crisEBack) * 70 * sinCr;

            circResultY = (newBack + newY) * 70.0 * sinCr - (crisEY + crisEBack) * 70 * cosCr;
            //        circResultY=(circSecondY+newY*70);
            if (redDotCounter >= 10) {
                if (arrayNumber < 60) {
                    resultAfterY[arrayNumber] = circResultX;
                    resultAfterX[arrayNumber] = circResultY;
                    //            arrayNumber++;
                } else {
                    for (tmp = 0; tmp < 59; tmp++) {
                        resultAfterX[tmp] = resultAfterX[tmp + 1];
                        resultAfterY[tmp] = resultAfterY[tmp + 1];
                    }
                    resultAfterY[59] = circResultX;
                    resultAfterX[59] = circResultY;
                }
            }
            setColor(drawctx, "#fff800");
            for (tmp = 0; tmp < arrayNumber - 1; tmp++) fillOval(drawctx, 568 - resultAfterX[tmp], 118 - resultAfterY[tmp], 5, 5);
            //drawLine(drawctx, 569, 119, 569 - circResultY, 119 - circResultX);
            //drawLine(drawctx, 570, 120, 570 - circResultY, 120 - circResultX);
            //drawLine(drawctx, 571, 121, 571 - circResultY, 121 - circResultX);


            //draw First circle...

            newY = Math.cos((time - 80 * 6) / 180 * Math.PI);
            newBack = Math.cos((time + phasa - 80 * 6) / 180 * Math.PI) * ampl;
            circSecondX = newY * cosCr + newBack * cosCrBet;
            circSecondY = newY * sinCr + newBack * sinCrBet;
            circResultX = circSecondX * cosCr;
            circResultY = circSecondX * sinCr;
            //setColor(drawctx, "#00ff00");
            //drawLine(drawctx, 419, 120, 419 - (70 * circResultY), 120 - (circResultX * 70));
            //drawLine(drawctx, 420, 120, 420 - (70 * circResultY), 120 - (circResultX * 70));
            //drawLine(drawctx, 421, 120, 421 - (70 * circResultY), 120 - (circResultX * 70));
            circResultX = circSecondY * 70 * sinCr;
            circResultY = circSecondY * 70.0 * cosCr;
            //setColor(drawctx, "#0000ff");
            //drawLine(drawctx, 419, 119, 419 + circResultY, 120 - circResultX);
            //drawLine(drawctx, 420, 120, 420 + circResultY, 120 - circResultX);
            //drawLine(drawctx, 418, 118, 418 + circResultY, 120 - circResultX);
            circResultX = newBack * 70.0 * Math.sin(recBet / 180 * Math.PI);
            circSecondY = newBack * 70.0 * Math.cos(recBet / 180 * Math.PI);
            circResultY = (circSecondY + newY * 70);
            if (redDotCounter >= 10) {
                redDotCounter = 0;
                if (arrayNumber < 60) {
                    resultArrayX[arrayNumber] = circResultX;
                    resultArrayY[arrayNumber] = circResultY;
                    arrayNumber++;
                } else {
                    for (tmp = 0; tmp < 59; tmp++) {
                        resultArrayX[tmp] = resultArrayX[tmp + 1];
                        resultArrayY[tmp] = resultArrayY[tmp + 1];
                    }
                    resultArrayX[59] = circResultX;
                    resultArrayY[59] = circResultY;
                }
            }
            setColor(drawctx, "#ff0000");
            for (tmp = 0; tmp < arrayNumber - 1; tmp++) fillOval(drawctx, 418 - resultArrayX[tmp], 118 - resultArrayY[tmp], 5, 5);
            //drawLine(drawctx, 419, 119, 419 - circResultX, 119 - circResultY);
            //drawLine(drawctx, 420, 120, 420 - circResultX, 120 - circResultY);
            //drawLine(drawctx, 421, 121, 421 - circResultX, 121 - circResultY);
        }

        function drawAxes(drawctx) {
            var cristCos, cristSin;
            cristCos = Math.cos(recCristall / 180 * Math.PI);
            cristSin = Math.sin(recCristall / 180 * Math.PI);
            var yCo = (85 * Math.sin((recCristall + 45) / 180 * Math.PI));
            var xCo = (85 * Math.cos((recCristall + 45) / 180 * Math.PI));
            drawctx.fillStyle = "#9F9f9f";
            drawctx.fillRect(0, 0, 700 * scaleX, 350 * scaleX);
            drawctx.fillStyle = "#000000";
            setColor(drawctx, "#000000");
            drawMyLine(drawctx, 0, 0, 0, 200, 0, 00);
            drawMyLine(drawctx, 0, 0, 0, 0, 100, 0);
            drawMyLine(drawctx, 0, 0, 0, 0, 0, 100);
            drawOval(drawctx, 500, 50, 140, 140);
            drawLine(drawctx, 495, 120, 645, 120);
            drawLine(drawctx, 570, 45, 570, 195);
            drawOval(drawctx, 350, 50, 140, 140);
            drawLine(drawctx, 345, 120, 495, 120);
            drawLine(drawctx, 420, 45, 420, 195);
            drawLine(drawctx, 100, 220, 100, 340);
            drawLine(drawctx, 100, 340, 300, 340);
            setColor(drawctx, "#ffffff");
            for (count = 180; count <= 190; count += 2)
                drawLine(drawctx, count, 340, count, 240);
            drawLine(drawctx, 180, 240, 190, 240);
            drawLine(drawctx, 570, 120, 570 - (75 * cristSin), 120 - (75 * cristCos));
            drawLine(drawctx, 420, 120, 420 - (75 * cristSin), 120 - (75 * cristCos));


            drawMyLine(drawctx, 85, 0, 0, 85, (100 * cristCos), (100 * cristSin));

            setColor(drawctx, "#ffffff");
            drawMyLine(drawctx, 80, xCo, yCo, 90, yCo, -xCo);
            drawMyLine(drawctx, 80, yCo, -xCo, 90, -xCo, -yCo);
            drawMyLine(drawctx, 80, -xCo, -yCo, 90, -yCo, xCo);
            drawMyLine(drawctx, 80, -yCo, xCo, 90, xCo, yCo);
            drawMyLine(drawctx, 90, xCo, yCo, 80, yCo, -xCo);
            drawMyLine(drawctx, 90, yCo, -xCo, 80, -xCo, -yCo);
            drawMyLine(drawctx, 90, -xCo, -yCo, 80, -yCo, xCo);
            drawMyLine(drawctx, 90, -yCo, xCo, 80, xCo, yCo);
            drawMyLine(drawctx, 80, xCo, yCo, 90, xCo, yCo);
            drawMyLine(drawctx, 80, yCo, -xCo, 90, yCo, -xCo);
            drawMyLine(drawctx, 80, -xCo, -yCo, 90, -xCo, -yCo);
            drawMyLine(drawctx, 80, -yCo, xCo, 90, -yCo, xCo);

            drawMyLine(drawctx, 80, xCo, yCo, 80, yCo, -xCo);
            drawMyLine(drawctx, 80, yCo, -xCo, 80, -xCo, -yCo);
            drawMyLine(drawctx, 80, -xCo, -yCo, 80, -yCo, xCo);
            drawMyLine(drawctx, 80, -yCo, xCo, 80, xCo, yCo);
            drawMyLine(drawctx, 90, xCo, yCo, 90, yCo, -xCo);
            drawMyLine(drawctx, 90, yCo, -xCo, 90, -xCo, -yCo);
            drawMyLine(drawctx, 90, -xCo, -yCo, 90, -yCo, xCo);
            drawMyLine(drawctx, 90, -yCo, xCo, 90, xCo, yCo);
            setColor(drawctx, "#000000");
            drawMyLine(drawctx, 85, 0, 0, 85, (100 * cristSin), -(100 * cristCos));
            drawLine(drawctx, 570, 120, 570 + (75 * cristCos), 120 - (75 * cristSin));
            drawLine(drawctx, 420, 120, 420 + (75 * cristCos), 120 - (75 * cristSin));

            drawLine(drawctx, 40, 55, 40, 105);
            drawLine(drawctx, 40, 105, 10, 135);
            drawLine(drawctx, 40, 105, 80, 105);

            drawString(drawctx, "k", 75, 104);
            setColor(drawctx, "#ffffff");
            drawString(drawctx, "0", 96, 350);
            drawString(drawctx, "y", 290, 350);
            drawString(drawctx, "S", 90, 230);
            drawString(drawctx, "<S>", 80, 310);
            drawString(drawctx, "x", 340, 115);
            drawString(drawctx, "z", 425, 45);
            drawString(drawctx, "z", 45, 60);
            drawString(drawctx, "x", 19, 133);
            drawString(drawctx, "y", 75, 115);
            drawString(drawctx, "0", 40, 115);
            drawString(drawctx, "x", 495, 115);
            drawString(drawctx, "z", 575, 45);
            setColor(drawctx, "#ff0000");
            drawString(drawctx, "E in", 410, 30);
            setColor(drawctx, "#fff800");
            drawString(drawctx, "E out", 555, 30);
        }
    </script>
</body>

</html>
